<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
			crossorigin="anonymous"
		/>
		<style>
			.imgcss {
				max-width: 600px;
				height: 300px;
				background-repeat: no-repeat;
				background-size: contain;
				background-position: center center;
				font-size: 90px;
				color: white;
				text-shadow: 5px 5px 2px black;
				display: flex;
				align-items: center;
				justify-content: center;
				margin-top: 10px;
			}
		</style>
	</head>

	<body>
		<div id="app">
			<div class="container-fluid mt-3">
				<button
					@click="getPic"
					:disabled="loading"
					class="btn btn-lg btn-outline-primary"
				>
					{{ btnLoading }}
				</button>
				<p>點擊按鈕隨機出現yes or no動圖(可重複)</p>
				<div :style="{backgroundImage: `url(${imgUrl})`}" class="imgcss">
					{{ message }}
				</div>
				{{ text }}
				<p>練習：Vue3 composition API(watch, ref)、JS async/await</p>
			</div>
		</div>
	</body>

	<script>
		const { createApp, ref, watch } = Vue;
		createApp({
			setup() {
				const text = ref('API來源：https://yesno.wtf/#');
				const toggleStatus = ref(false);
				const loading = ref(false);
				const btnLoading = ref('Yes or No, WTF?');
				const imgUrl = ref('#');
				const message = ref(null);
				function getPic() {
					toggleStatus.value = !toggleStatus.value;
				}
				watch(toggleStatus, getAnswer);
				async function getAnswer() {
					loading.value = true;
					btnLoading.value = '圖片載入中...';
					try {
						const res = await fetch('https://yesno.wtf/api');
						const apiData = await res.json();
						const img = new Image();
						img.onload = function () {
							loading.value = false;
							btnLoading.value = 'Yes or No, WTF?';
						};
						img.src = apiData.image;
						imgUrl.value = apiData.image;
						message.value = apiData.answer;
					} catch (err) {
						console.log(err);
					}
				}

				return {
					text,
					toggleStatus,
					loading,
					btnLoading,
					imgUrl,
					message,
					getPic,
				};
			},
		}).mount('#app');
	</script>
</html>
